# ~exec 命令

> 执行模式 — 执行已有方案包或直接从需求开始执行。

```yaml
触发: 用户输入 ~exec [方案ID|需求描述]
子命令:
  ~exec (无参数): 列出可用方案包并选择执行
  ~exec <方案ID>: 直接执行指定方案包
  ~exec <需求描述>: combo 模式 — 先规划再确认再执行
```

## ~exec（无参数）

```yaml
流程:
  1. 扫描 .agentflow/kb/plan/ 目录
  2. 筛选未完成的方案包（状态非 ✅）

有方案包时:
  💡【AgentFlow】- 可执行方案

  | # | 方案包 | 进度 | 状态 |
  |---|--------|------|------|
  | 1 | {id}_{feature} | {done}/{total} | ⬜/🔄 |

  输入序号选择执行，或输入 0 取消。
  🔄 下一步: 输入序号执行 | ~exec <需求> 创建并执行新方案

无方案包时:
  📭 暂无可执行的方案包。
  💡 你可以:
    1. ~plan <需求> — 先创建方案再执行
    2. ~exec <需求> — 直接描述需求，我会先规划再执行
    3. 直接描述你的需求，我会按路由级别处理

  🔄 下一步: 描述你的需求或使用 ~plan 创建方案

全部完成时:
  ✅ 所有方案包中的任务已完成！
  💡 你可以:
    1. ~plan <新需求> — 创建新方案
    2. 直接描述新需求
  🔄 下一步: 开始新任务
```

## ~exec <方案ID>

```yaml
流程:
  1. 加载 .agentflow/kb/plan/{id}/tasks.md
  2. 找到第一个未完成任务 ([ ] 或 [!])
  3. 选择执行模式:
     请选择执行方式:
     1. 交互式执行：关键决策点等待你确认。（推荐）
     2. 全自动执行：自动完成所有阶段，仅遇到风险时暂停。
     3. 持续执行：全流程自动完成所有任务，多轮审查与测试，完成后输出完整报告。
  4. CURRENT_STAGE = DEVELOP
  5. 按 stages/develop.md 从该任务继续执行

方案ID不存在时:
  ❌ 找不到方案包: {id}
  💡 使用 ~plan list 查看可用方案
```

## ~exec <需求描述>（Combo 模式）

```yaml
流程:
  1. 📝 先进入 DESIGN 阶段（同 ~plan <需求>）
  2. 生成 tasks.md 后输出方案摘要
  3. 询问确认:
     💡【AgentFlow】- DESIGN ✅: 方案规划完成

     📋 方案摘要: {摘要}
     📄 任务清单: {total} 项任务

     请选择执行方式:
     1. 交互式执行：关键决策点等待你确认。（推荐）
     2. 全自动执行：自动完成所有阶段，仅遇到风险时暂停。
     3. 持续执行：全流程自动完成所有任务，多轮审查与测试，完成后输出完整报告。
     4. 仅保存方案，稍后执行。

  4. 用户选 1/2/3 → 设置对应 WORKFLOW_MODE → DEVELOP
  5. 用户选 4 → 保存方案后 ⛔ END_TURN
```
