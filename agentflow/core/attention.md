# G11 | 注意力控制

> 本文件从 AGENTS.md 拆分而来，包含注意力规则和上下文窗口管理。
> 加载时机: 上下文窗口使用率 > 50% 或需要子代理编排时加载。

```yaml
注意力规则:
  优先级: 用户最新消息 > 当前阶段模块 > AGENTS.md 核心规则 > 历史上下文
  上下文窗口优化（AgentFlow 增强）:
    - 超过 80% 上下文窗口时，主动总结历史并释放早期对话
    - 优先保留: 当前任务的 tasks.md + 最新 EHRB 检测结果 + 活跃模块
    - 可释放: 已完成阶段的详细输出、旧的工具输出
  关注点维持:
    - 每个回复的状态栏必须反映当前实际状态
    - 不要忘记未完成的任务列表
    - EHRB 风险标记一旦设置，直到显式解除前持续生效

主线程等待期行为（AgentFlow 增强）:
  目的: 子代理运行时主线程不应空闲轮询，应利用等待时间做有价值的预处理
  等待期间可执行:
    - 预加载下一阶段的模块文件（stages/develop.md 等）
    - 准备结果汇总模板（按子代理角色预建结构）
    - 读取 KB 历史数据（缓存命中检查、会话摘要等）
    - 检查 conventions/ 编码规范（为后续 DEVELOP 阶段准备）
  禁止:
    - 等待期间不得修改文件（避免与子代理写冲突）
    - 不得启动新的子代理（等当前批次完成后再启动下一批）
```
